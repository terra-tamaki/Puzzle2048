# ブロック崩しゲーム 要件定義書

**バージョン**: 1.0.0  
**最終更新日**: 2025-08-27  
**ステータス**: ドラフト  

## 1. プロジェクト概要

### 1.1 目的と背景

ブラウザーで動作するポップなデザインのブロック崩しゲームを作成し、10分〜30分程度の適度な時間で楽しめる、見やすく美しいゲーム体験を提供する。特にポップなデザインによる見やすさを重視し、1人のプレイヤーが自分のペースで難易度を調整しながら楽しめることを目指す。

### 1.2 ターゲットユーザー

- **主要ユーザー層**: 1名でのプレイを想定（個人プレイヤー）
- **利用シーン**: 10分〜30分程度の適度な時間でリラックスして楽しみたい時
- **重視する価値**: ポップで見やすいデザイン、自分に合った難易度での快適なプレイ

### 1.3 核となる機能と価値

以下は、プロジェクトの本質的価値を提供するために「絶対に必要」な機能です。各機能は「この機能がないとプロジェクトの目的達成が不可能になる」という基準で厳選されています。

- **基本的なブロック崩しゲーム動作**: ボール、パドル、ブロックの表示と当たり判定によるゲーム進行 - *この機能がないとブロック崩しゲームとして成立しない*
- **ポップなデザインでの見やすい表示**: 明るく楽しい色合いによる視認性の高いUI - *この機能がないとプロジェクトの最重要目的である「見やすさ」が実現できない*
- **ゲーム開始前の難易度調整**: ブロックとパドルの距離とボール速度の事前設定 - *この機能がないと個人の好みに合わせた快適なプレイ体験が提供できない*

## 2. 画面一覧

このアプリケーションは以下の画面要素と実際のページで構成されます。各ページのモックアップは作成後に詳細化されます。

### 2.1 画面要素一覧

以下は機能的に必要な全ての画面要素です。これらは必ずしも独立したページとして実装されるわけではありません。

| 画面要素名 | 目的 | 実現する核心的価値 |
|----------|------|----------------|
| 難易度設定要素 | ゲーム開始前の難易度調整 | 個人に最適化されたゲーム体験の提供 |
| ゲームエリア要素 | ブロック崩しゲームの実行 | 基本的なゲーム価値の提供 |
| スコア表示要素 | プレイ結果の可視化 | 達成感と継続モチベーションの提供 |
| 残機表示要素 | ゲーム状況の把握 | プレイヤーの戦略判断支援 |
| 操作UI要素 | ゲーム制御機能 | スムーズなゲーム進行の実現 |
| 結果表示要素 | ゲーム終了時の情報表示 | 満足感と再プレイ意欲の喚起 |

### 2.2 ページ構成計画

上記の画面要素を、ユーザー体験とナビゲーション効率を最適化するために以下のように統合・構成します。シンプルな構成でページ動線を分かりやすくします。

#### 2.2.1 ゲームページ

| ID | ページ名 | 主な目的 | 含まれる画面要素 | 優先度 | モックアップ | 実装状況 |
|----|---------|---------|----------------|-------|------------|------------|
| G-001 | 設定画面 | 難易度調整とゲーム開始 | 難易度設定要素、ゲーム開始ボタン | 高 | [settings.html](/mockups/settings.html) | モックアップ完了 |
| G-002 | ゲーム画面 | メインプレイ画面 | ゲームエリア要素、スコア表示要素、残機表示要素、操作UI要素 | 高 | [game.html](/mockups/game.html) | モックアップ完了 |
| G-003 | ゲームオーバー画面 | 結果表示と次の行動選択 | 結果表示要素、再プレイボタン、設定戻りボタン | 高 | [gameover.html](/mockups/gameover.html) | モックアップ完了 |

### 2.3 主要ルート定義

| パス | ページID | 説明 |
|------|---------|------|
| `/` | G-001 | 設定画面（初期画面） |
| `/game` | G-002 | ゲーム画面 |
| `/gameover` | G-003 | ゲームオーバー画面 |

### 2.4 特殊な画面遷移

- 設定画面でゲーム開始 → ゲーム画面へ自動遷移
- ゲームオーバー時 → ゲームオーバー画面へ自動遷移
- ゲームオーバー画面で設定戻り → 設定画面へ遷移
- ゲームオーバー画面で再プレイ → ゲーム画面へ遷移（前回設定を保持）

### 2.5 共通レイアウト構成

#### レイアウトパターン
- **統一レイアウト**: ポップなデザインテーマで全画面を統一
- **シンプル構成**: ヘッダーやサイドバーなしの全画面レイアウト
- **中央集約型**: 主要コンテンツを画面中央に配置

## 3. ページ詳細

このセクションでは、各ページの詳細と、それらに含まれる画面要素について説明します。

### 3.1 設定画面 (G-001)
**モックアップ**: [settings.html](/mockups/settings.html)

**ページ概要**: ゲーム開始前に難易度を調整し、プレイを開始するための画面

**含まれる画面要素**:
- ゲームタイトルとアイコン: ブランド認識とユーザーエンゲージメント
- 距離調整スライダー: ブロックとパドル間距離（50-200px、デフォルト100px）
- 速度調整スライダー: ボール速度（1.0-5.0、デフォルト3.0）
- リアルタイムプレビュー: 設定値と難易度レベルの即座表示
- 難易度インジケーター: やさしい・ふつう・難しいの視覚的表示
- ゲーム開始ボタン: 設定保存とゲーム画面遷移

**状態と動作**:
- 初期ロード時: デフォルト設定値（距離100px、速度3.0）で表示
- 保存設定復元: 前回プレイ時の設定がある場合は自動復元
- スライダー操作時: リアルタイムでプレビュー値と難易度レベルを更新
- 設定確定時: ローカルストレージに設定を保存し、ゲーム画面に遷移
- ホバーエフェクト: ボタンに視覚的フィードバックを提供

**データとAPI**:
- 設定データモデル: { paddleBlockDistance: number(50-200), ballSpeed: number(1.0-5.0) }
- ローカルストレージキー: 'gameSettings'
- 難易度判定ロジック: 距離80px以下かつ速度2.0以下で「やさしい」、距離150px以上または速度4.0以上で「難しい」
- 設定値検証: 範囲外値の自動補正機能

### 3.2 ゲーム画面 (G-002)
**モックアップ**: [game.html](/mockups/game.html)

**ページ概要**: 実際のブロック崩しゲームをプレイするメイン画面

**含まれる画面要素**:
- ゲームヘッダー: スコア表示、残機表示、操作ボタンの統合UI
- ゲームエリア: 800x600pxの中央配置ゲーム領域（ダークテーマ）
- ブロック群: 5行8列（計40個）のカラフルなグラデーションブロック
- ボール: 20px径の3Dエフェクト付き球体（初期位置中央下部）
- パドル: 120px幅の紫色パドル（底部中央、マウス追従）
- レベル表示: 左上のレベルインジケーター
- 一時停止オーバーレイ: 半透明背景の一時停止UI
- 操作説明: ゲーム開始前の操作ガイド表示

**状態と動作**:
- 初期化時: 設定値に基づくゲーム要素配置と物理パラメータ設定
- ゲーム開始待機: SPACE/クリックでゲーム開始、操作説明表示
- アクティブプレイ: 16msごとの物理演算とCanvas描画更新
- マウス操作: リアルタイムパドル位置更新（境界制限付き）
- キーボード操作: SPACE（開始）、ESC（一時停止）
- ブロック破壊: 当たり判定による視覚エフェクトとスコア加算
- ライフ管理: ミス時の残機減少と継続/終了判定
- 一時停止: オーバーレイ表示とゲームループ停止

**データとAPI**:
- ゲーム状態: { score: number, lives: number(初期3), isPaused: boolean, isGameStarted: boolean }
- 物理オブジェクト: { ball: {x, y, vx, vy, radius}, paddle: {x, y, width, height}, blocks: Block[] }
- ブロックモデル: { x: number, y: number, width: 80, height: 30, color: string, destroyed: boolean, row: number, col: number }
- 入力処理: マウス座標変換とキーボードイベントハンドリング
- アニメーションループ: requestAnimationFrame による60FPS描画
- 当たり判定: AABB（Axis-Aligned Bounding Box）による矩形衝突検出

### 3.3 ゲームオーバー画面 (G-003)
**モックアップ**: [gameover.html](/mockups/gameover.html)

**ページ概要**: ゲーム終了時の結果表示と次の行動選択画面

**含まれる画面要素**:
- 結果ヘッダー: 勝敗に応じた動的アイコンとメッセージ
- 紙吹雪エフェクト: 勝利時のCSS3アニメーション（20個のカラフルパーティクル）
- アチーブメント表示: プレイ評価メッセージとアイコン
- 最終スコア表示: グラデーション背景の大型スコア表示
- 統計グリッド: プレイ時間、破壊ブロック数、難易度、残ライフの2x2レイアウト
- 進捗バー: ブロック破壊率の視覚的プログレスバー
- アクションボタン: 再プレイ（緑）と設定変更（青枠）の明確な選択肢

**状態と動作**:
- 初期化時: ゲーム結果データの読み込みと表示更新
- 勝利判定: 全ブロック破壊またはライフ残存での結果分岐表示
- 敗北判定: ライフ0での結果表示（紙吹雪なし、励ましメッセージ）
- 設定連携: 保存済み設定の読み込みと難易度表示更新
- 統計計算: プレイデータからの派生情報算出と表示
- デモモード: ESCキーによる勝敗状態切り替え（開発/デモ用）
- トランジション: ホバーエフェクトとクリック時のボタンフィードバック

**データとAPI**:
- 結果データモデル: { isVictory: boolean, finalScore: number, playTime: string, blocksDestroyed: number, totalBlocks: number, remainingLives: number, difficulty: string }
- ローカルストレージキー: 'gameResult'（ゲーム画面から受け渡し）
- 統計算出: 破壊率 = blocksDestroyed / totalBlocks * 100
- 難易度判定: 設定値に基づく「やさしい」「ふつう」「難しい」「カスタム」の表示
- エフェクト制御: 勝利時の紙吹雪アニメーション生成と自動削除
- 状態管理: 結果表示の動的切り替えとUI要素の条件表示

## 4. データモデル概要

モックアップから導出される主要データモデルを以下に示します。すべての型定義は後続フェーズで`shared/index.ts`で一元管理されます。

### 4.1 主要エンティティ

| エンティティ | 主な属性 | 関連エンティティ | 備考 |
|------------|----------|----------------|------|
| GameSettings | paddleBlockDistance, ballSpeed | - | 難易度設定データ |
| GameState | score, lives, blocks, ball, paddle | Block, Ball, Paddle | ゲーム実行状態 |
| Block | x, y, width, height, color, destroyed | - | ブロック単体データ |
| Ball | x, y, vx, vy, radius | - | ボール物理データ |
| Paddle | x, y, width, height | - | パドル位置データ |

## 5. 特記すべき非機能要件

以下は標準的な実装方針から特に注意すべき点です：

- **ブラウザー対応**: モダンブラウザー（Chrome、Firefox、Safari、Edge）での動作保証
- **ポップなデザイン**: 明るく楽しい色合いとフォントによる視覚的魅力
- **適度なプレイ時間**: 10分〜30分程度で満足できるゲームバランス調整
- **リアルタイム性**: 滑らかなボールの動きと即座の当たり判定レスポンス

## 6. 開発計画とマイルストーン

| フェーズ | 内容 | 期間 | ステータス |
|---------|------|------|----------|
| フェーズ1 | 要件定義・設計 | - | 完了 |
| フェーズ2 | モックアップ作成 | - | 完了 |
| フェーズ3 | 基本ゲーム機能実装 | - | 未着手 |
| フェーズ4 | デザイン・UI実装 | - | 未着手 |
| フェーズ5 | 難易度調整機能実装 | - | 未着手 |
| フェーズ6 | 最終調整・テスト | - | 未着手 |

## 7. 添付資料

- モックアップファイル: /mockups/ ディレクトリに格納予定
- 技術仕様書: 後続フェーズで作成予定