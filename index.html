<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puzzle2048 - ç¾ã—ã„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®2048ãƒ‘ã‚ºãƒ«</title>
    <link rel="stylesheet" href="css/puzzle2048-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>
    <!-- ã‚²ãƒ¼ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="game-header">
        <div class="score-section">
            <div class="score-item">
                <div class="score-label">ã‚¹ã‚³ã‚¢</div>
                <div class="score-value" id="current-score">0</div>
            </div>
            <div class="score-item">
                <div class="score-label">ãƒ™ã‚¹ãƒˆ</div>
                <div class="score-value" id="best-score">0</div>
            </div>
        </div>
        <div class="header-buttons">
            <button class="restart-btn" id="restart-button">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <button class="demo-btn" id="demo-button">ğŸ¤– ãƒ‡ãƒ¢</button>
            <button class="settings-btn" id="settings-button">âš™ï¸</button>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="game-container">
        <div class="game-grid" id="game-grid">
            <!-- ç©ºã®ã‚°ãƒªãƒƒãƒ‰ã‚»ãƒ« -->
            <div class="grid-cell"></div>
            <div class="grid-cell"></div>
            <div class="grid-cell"></div>
            <div class="grid-cell"></div>
            <div class="grid-cell"></div>
            <div class="grid-cell"></div>
            <div class="grid-cell"></div>
            <div class="grid-cell"></div>
            <div class="grid-cell"></div>
            <div class="grid-cell"></div>
            <div class="grid-cell"></div>
            <div class="grid-cell"></div>
            <div class="grid-cell"></div>
            <div class="grid-cell"></div>
            <div class="grid-cell"></div>
            <div class="grid-cell"></div>
        </div>

        <!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆå‹åˆ©ãƒ»æ•—åŒ—æ™‚ï¼‰ -->
        <div class="game-overlay" id="game-overlay">
            <div class="overlay-message" id="overlay-message">ğŸ‰ 2048é”æˆï¼</div>
            <div class="overlay-submessage" id="overlay-submessage">ç¶™ç¶šã—ã¾ã™ã‹ï¼Ÿ</div>
            <div class="overlay-buttons">
                <button class="overlay-btn primary" id="continue-button">ç¶™ç¶š</button>
                <button class="overlay-btn secondary" id="restart-from-overlay">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
                <button class="overlay-btn secondary" id="view-result">çµæœã‚’è¦‹ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- æ“ä½œã‚¬ã‚¤ãƒ‰ -->
    <div class="controls-guide">
        <div class="controls-title">æ“ä½œæ–¹æ³•</div>
        <div class="controls-grid">
            <div class="control-item">
                <div class="control-key">â†‘â†“â†â†’</div>
                <div class="control-desc">ã‚¿ã‚¤ãƒ«ç§»å‹•</div>
            </div>
            <div class="control-item">
                <div class="control-key">R</div>
                <div class="control-desc">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</div>
            </div>
            <div class="control-item">
                <div class="control-key">ESC</div>
                <div class="control-desc">ä¸€æ™‚åœæ­¢</div>
            </div>
            <div class="control-item">
                <div class="control-key">M</div>
                <div class="control-desc">ãƒŸãƒ¥ãƒ¼ãƒˆ</div>
            </div>
        </div>
    </div>

    <!-- ãƒ‡ãƒ¢ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆãƒ‡ãƒ¢å®Ÿè¡Œä¸­ã®ã¿è¡¨ç¤ºï¼‰ -->
    <div class="demo-controls" id="demo-controls" style="display: none;">
        <div class="demo-status">
            <span id="demo-status">ğŸ¤– ãƒ‡ãƒ¢ãƒ—ãƒ¬ã‚¤ä¸­...</span>
            <span id="demo-moves">æ‰‹æ•°: 0</span>
        </div>
        <div class="demo-buttons">
            <button class="demo-control-btn" id="demo-pause">â¸ï¸</button>
            <button class="demo-control-btn" id="demo-stop">â¹ï¸</button>
            <select class="demo-speed" id="demo-speed">
                <option value="0.5">0.5å€é€Ÿ</option>
                <option value="1" selected>æ¨™æº–</option>
                <option value="2">2å€é€Ÿ</option>
                <option value="3">3å€é€Ÿ</option>
            </select>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ çµ±è¨ˆè¡¨ç¤ºï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰ -->
    <div class="debug-info" id="debug-info" style="display: none;">
        <div>æ‰‹æ•°: <span id="moves-count">0</span></div>
        <div>åˆä½“å›æ•°: <span id="merge-count">0</span></div>
        <div>æœ€é«˜ã‚¿ã‚¤ãƒ«: <span id="max-tile">0</span></div>
        <div>çŠ¶æ…‹: <span id="game-status">playing</span></div>
    </div>

    <!-- JavaScript -->
    <script src="js/game-engine.js"></script>
    <script src="js/animation-controller.js"></script>
    <script src="js/audio-manager.js"></script>
    <script src="js/ui-controller.js"></script>
    <script src="js/demo-ai.js"></script>
    <script>
        // è¨­å®šèª­ã¿è¾¼ã¿ã¨ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¾ãŸã¯ä¿å­˜ã•ã‚ŒãŸè¨­å®šã‚’èª­ã¿è¾¼ã¿
            const urlParams = new URLSearchParams(window.location.search);
            let settings = {};
            
            try {
                const savedSettings = localStorage.getItem('puzzle2048_settings');
                settings = savedSettings ? JSON.parse(savedSettings) : {};
            } catch (error) {
                console.warn('è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            }
            
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§è¨­å®šã‚’ä¸Šæ›¸ã
            const difficulty = urlParams.get('difficulty') || settings.difficulty || 'easy';
            const volume = parseInt(urlParams.get('volume')) || settings.volume || 70;
            const muted = urlParams.get('muted') === 'true' || settings.muted || false;
            const animationSpeed = parseInt(urlParams.get('animationSpeed')) || settings.animationSpeed || 2;
            const showDebug = urlParams.get('showDebug') === 'true' || settings.showDebug || false;
            
            // é›£æ˜“åº¦ã«å¿œã˜ãŸã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³åˆæœŸåŒ–
            const gameEngine = new GameEngine(difficulty);
            const uiController = new UIController(gameEngine);
            
            // è¨­å®šã‚’é©ç”¨
            uiController.audioManager.setVolume(volume / 100);
            if (muted) uiController.audioManager.toggleMute();
            uiController.animationController.setSpeed(animationSpeed);
            
            // ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºè¨­å®š
            if (showDebug) {
                document.getElementById('debug-info').style.display = 'block';
            }
            
            // è¨­å®šãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            document.getElementById('settings-button').addEventListener('click', () => {
                window.location.href = 'settings.html';
            });
            
            // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ï¼ˆé–‹ç™ºç”¨ï¼‰
            window.game = gameEngine;
            window.ui = uiController;
            window.animations = uiController.animationController;
            window.audio = uiController.audioManager;
            
            // ãƒ‡ãƒ¢AIåˆæœŸåŒ–
            window.demoAI = new DemoAI(gameEngine);
            
            // ãƒ‡ãƒ¢ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('demo-button').addEventListener('click', function() {
                if (window.demoAI.isRunning) {
                    window.demoAI.stopDemo();
                    this.textContent = 'ğŸ¤– ãƒ‡ãƒ¢';
                    document.getElementById('demo-controls').style.display = 'none';
                } else {
                    window.demoAI.startDemo();
                    this.textContent = 'â¹ï¸ åœæ­¢';
                    document.getElementById('demo-controls').style.display = 'flex';
                }
            });
            
            // ãƒ‡ãƒ¢ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('demo-pause').addEventListener('click', function() {
                window.demoAI.togglePause();
                this.textContent = window.demoAI.isPaused ? 'â–¶ï¸' : 'â¸ï¸';
            });
            
            document.getElementById('demo-stop').addEventListener('click', function() {
                window.demoAI.stopDemo();
                document.getElementById('demo-button').textContent = 'ğŸ¤– ãƒ‡ãƒ¢';
                document.getElementById('demo-controls').style.display = 'none';
            });
            
            document.getElementById('demo-speed').addEventListener('change', function() {
                const speed = parseFloat(this.value);
                window.demoAI.setSpeed(speed);
            });
            
            console.log(`ğŸ® Puzzle2048 ã‚²ãƒ¼ãƒ é–‹å§‹ï¼ (é›£æ˜“åº¦: ${difficulty})`);
            console.log('çŸ¢å°ã‚­ãƒ¼ã§ã‚¿ã‚¤ãƒ«ã‚’ç§»å‹•ã—ã¦ãã ã•ã„');
            console.log('F12: ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ | M: ãƒŸãƒ¥ãƒ¼ãƒˆåˆ‡ã‚Šæ›¿ãˆ | âš™ï¸: è¨­å®š | ğŸ¤–: ãƒ‡ãƒ¢ãƒ—ãƒ¬ã‚¤');
            console.log('éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ ã¯æœ€åˆã®æ“ä½œã§åˆæœŸåŒ–ã•ã‚Œã¾ã™');
        });
    </script>
</body>
</html>