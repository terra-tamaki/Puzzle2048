<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ブロック崩しゲーム - ゲームオーバー</title>
    <!-- Material UI CDN -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 20px;
        }
        
        .gameover-container {
            background: rgba(255,255,255,0.95);
            color: #333;
            padding: 50px;
            border-radius: 25px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .gameover-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, #e74c3c, #f39c12, #f1c40f, #27ae60, #3498db, #9b59b6);
        }
        
        .game-result {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .game-result.victory {
            color: #27ae60;
        }
        
        .game-result.defeat {
            color: #e74c3c;
        }
        
        .result-icon {
            font-size: 3.5rem;
        }
        
        .final-score {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.2);
        }
        
        .score-label {
            font-size: 1.2rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .score-value {
            font-size: 3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #3498db;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .action-btn {
            padding: 18px 30px;
            font-size: 1.2rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-replay {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            box-shadow: 0 8px 20px rgba(39, 174, 96, 0.3);
        }
        
        .btn-replay:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(39, 174, 96, 0.4);
        }
        
        .btn-settings {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .btn-settings:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }
        
        .material-icons {
            font-size: 1.3rem;
        }
        
        .celebration {
            position: absolute;
            top: -20px;
            left: -20px;
            right: -20px;
            height: 40px;
            pointer-events: none;
            overflow: hidden;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #f1c40f;
            animation: confettiFall 3s linear infinite;
        }
        
        @keyframes confettiFall {
            0% { transform: translateY(-100px) rotateZ(0deg); opacity: 1; }
            100% { transform: translateY(600px) rotateZ(360deg); opacity: 0; }
        }
        
        .achievement {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .level-progress {
            background: #ecf0f1;
            height: 8px;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="gameover-container">
        <div class="celebration" id="celebration"></div>
        
        <div class="game-result victory" id="gameResult">
            <span class="material-icons result-icon">emoji_events</span>
            クリア！
        </div>
        
        <div class="achievement" id="achievement">
            <span class="material-icons">star</span>
            素晴らしいプレイでした！
        </div>
        
        <div class="final-score">
            <div class="score-label">最終スコア</div>
            <div class="score-value">
                <span class="material-icons">stars</span>
                <span id="finalScore">1250</span>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-label">プレイ時間</div>
                <div class="stat-value">
                    <span class="material-icons">schedule</span>
                    <span id="playTime">5:32</span>
                </div>
            </div>
            
            <div class="stat-item">
                <div class="stat-label">破壊ブロック</div>
                <div class="stat-value">
                    <span class="material-icons">auto_awesome</span>
                    <span id="blocksDestroyed">38/40</span>
                </div>
            </div>
            
            <div class="stat-item">
                <div class="stat-label">難易度設定</div>
                <div class="stat-value">
                    <span class="material-icons">tune</span>
                    <span id="difficulty">標準</span>
                </div>
            </div>
            
            <div class="stat-item">
                <div class="stat-label">残ライフ</div>
                <div class="stat-value">
                    <span class="material-icons">favorite</span>
                    <span id="remainingLives">2</span>
                </div>
            </div>
        </div>
        
        <div class="level-progress">
            <div class="progress-fill" style="width: 95%" id="progressFill"></div>
        </div>
        <p style="font-size: 0.9rem; color: #666; margin-bottom: 30px;">次回はさらなる高スコアを目指しましょう！</p>
        
        <div class="action-buttons">
            <button class="action-btn btn-replay" onclick="replayGame()">
                <span class="material-icons">replay</span>
                同じ設定で再プレイ
            </button>
            
            <button class="action-btn btn-settings" onclick="goToSettings()">
                <span class="material-icons">settings</span>
                設定を変更してプレイ
            </button>
        </div>
    </div>

    <script>
        // ゲーム結果の状態管理
        let gameResult = {
            isVictory: true,
            finalScore: 1250,
            playTime: "5:32",
            blocksDestroyed: 38,
            totalBlocks: 40,
            remainingLives: 2,
            difficulty: "標準"
        };
        
        // 保存された設定とゲーム結果の読み込み
        function loadGameResult() {
            // 実際の実装では、ゲーム画面から渡されたデータを使用
            const savedSettings = localStorage.getItem('gameSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                // 設定に基づいて難易度表示を更新
                updateDifficultyDisplay(settings);
            }
            
            // ローカルストレージからゲーム結果を読み込み（デモ用）
            const savedResult = localStorage.getItem('gameResult');
            if (savedResult) {
                gameResult = { ...gameResult, ...JSON.parse(savedResult) };
                updateDisplay();
            }
        }
        
        // 設定に基づく難易度表示の更新
        function updateDifficultyDisplay(settings) {
            const distance = settings.paddleBlockDistance;
            const speed = settings.ballSpeed;
            
            let difficultyText = "カスタム";
            if (distance <= 80 && speed <= 2) difficultyText = "やさしい";
            else if (distance <= 120 && speed <= 3.5) difficultyText = "ふつう";
            else if (distance >= 150 || speed >= 4) difficultyText = "難しい";
            
            gameResult.difficulty = difficultyText;
        }
        
        // 表示の更新
        function updateDisplay() {
            // 勝敗の表示
            const resultElement = document.getElementById('gameResult');
            const achievementElement = document.getElementById('achievement');
            
            if (gameResult.isVictory) {
                resultElement.className = 'game-result victory';
                resultElement.innerHTML = `
                    <span class="material-icons result-icon">emoji_events</span>
                    クリア！
                `;
                achievementElement.innerHTML = `
                    <span class="material-icons">star</span>
                    素晴らしいプレイでした！
                `;
                createConfetti();
            } else {
                resultElement.className = 'game-result defeat';
                resultElement.innerHTML = `
                    <span class="material-icons result-icon">sentiment_dissatisfied</span>
                    ゲームオーバー
                `;
                achievementElement.innerHTML = `
                    <span class="material-icons">refresh</span>
                    次回はきっとクリアできます！
                `;
            }
            
            // 統計情報の更新
            document.getElementById('finalScore').textContent = gameResult.finalScore;
            document.getElementById('playTime').textContent = gameResult.playTime;
            document.getElementById('blocksDestroyed').textContent = `${gameResult.blocksDestroyed}/${gameResult.totalBlocks}`;
            document.getElementById('difficulty').textContent = gameResult.difficulty;
            document.getElementById('remainingLives').textContent = gameResult.remainingLives;
            
            // 進捗バーの更新
            const progressPercent = (gameResult.blocksDestroyed / gameResult.totalBlocks) * 100;
            document.getElementById('progressFill').style.width = progressPercent + '%';
        }
        
        // 紙吹雪エフェクト（勝利時）
        function createConfetti() {
            const celebration = document.getElementById('celebration');
            const colors = ['#e74c3c', '#f39c12', '#f1c40f', '#27ae60', '#3498db', '#9b59b6'];
            
            for (let i = 0; i < 20; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 3 + 's';
                celebration.appendChild(confetti);
                
                // 3秒後に削除
                setTimeout(() => {
                    if (confetti.parentNode) {
                        confetti.parentNode.removeChild(confetti);
                    }
                }, 6000);
            }
        }
        
        // 再プレイ（同じ設定）
        function replayGame() {
            // 同じ設定でゲーム画面に遷移
            alert('同じ設定でゲームを再開します！\\n設定は保持されます。');
            // window.location.href = '/game'; // 実装時
        }
        
        // 設定画面に戻る
        function goToSettings() {
            alert('設定画面に戻ります。\\n難易度を調整してからプレイできます。');
            // window.location.href = '/'; // 実装時
        }
        
        // デモ用：勝敗の切り替え
        function toggleResult() {
            gameResult.isVictory = !gameResult.isVictory;
            if (!gameResult.isVictory) {
                gameResult.finalScore = 680;
                gameResult.playTime = "3:45";
                gameResult.blocksDestroyed = 22;
                gameResult.remainingLives = 0;
            } else {
                gameResult.finalScore = 1250;
                gameResult.playTime = "5:32";
                gameResult.blocksDestroyed = 38;
                gameResult.remainingLives = 2;
            }
            updateDisplay();
        }
        
        // デモ用：Escapeキーで勝敗切り替え
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                toggleResult();
            }
        });
        
        // 初期化
        window.addEventListener('load', function() {
            loadGameResult();
            updateDisplay();
        });
    </script>
</body>
</html>